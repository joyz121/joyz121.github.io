# 本科项目总结

## QT上位机

###环境

编辑器：QT Creator、编程语言：C++

### 串口通讯

实现方式：QT提供了串口通信类QSerialPort

1. 设置：串口号、波特率、数据位数、校验位

2. 连接信号槽函数，当下位机发送数据，会发送一个readyread信号。
3. 接收用read，用write发送

通信协议：帧头+数据+CRC校验码+帧尾

#### CRC-8 循环冗余校验

1.模二除法-每一位除的结果不影响其他位==异或

2.二进制表示多项式

实现：

1. 每次和需要计算的数据异或。
2. 最高位是1，左移后与多项式异或，否则直接左移。
3. 执行8次。

###波形图绘制

QCustomPlot

###数据库

 SQLite 功能增删改查、Qsqltablemodel封装好了



------



## 智能车之信标组

### 目标

场地上有多个圆台形的信标，信标灯会发出**以0.2048s为周期频率250HZ-2000Hz的chirp信号**和95mhz的调频信号，目标是让信标车完成定位、追踪、避障。

名词解释：chirp信号：线性调频，载频在脉冲持续时间内线性地增加。chirp信号带宽保证了有噪声但是相关后的峰值还是明显。

### 硬件

- 主控为英飞凌TC264 **32位双核**cpu。我们用一个核进行互相关运算，另一个核进行控制行为
- 4个声音传感器（麦克风）
- 4个Tof激光测距模块
- 2个摄像头
- 驱动和编码器

### 软件

- 内存分配：cpu0-72KB cpu1-120KB

音频数据：4* 2048 *2Byte=16KB

FM数据：1 * 2048* 2Byte=4KB

FFT输入数组 2* 2048* 8Byte=32KB

FFT输出数组2* 2048 *8Byte=32KB

音频Buffer数据：4 * 512 *2Byte=4KB

- ==采集==：

ADC 采集 ，**软件中断**采集0.1ms 采集一次 

10Khz*2048=0.2048s 太慢了，所以加入了Buffer，根据先进先出的原则，采集完Buffer后就进行一次互相关运算。（memcpy）

- ==定位方式==

4个Mic逆时针顺序标号，获得四个时延数据，存入数组，并根据实际长度剔除错误数据

第一种方法：公式法，根据几何关系得出角度。pass-时延精度不够，3.4*时延坐标（精度3.4cm）

第二种方法：查表，通过实验标定。pass -精度不够，并且一个值变了，角度就会跳变

第三种方法：找出目标的大概位置。得到象限位置。再用摄像头寻找相应目标

- 互相关

  和卷积相似，卷积是反转滑动相乘求和，互相关没有翻转。其相关运算相当于求两函数的曲线相对平移 1个参变量x后形成的重叠部分与横轴所围区域的面积

- ==摄像头==

1、openmv 阈值编辑器找出蓝色块和银白色块的阈值。

2、openmv 先找出底色-最大的蓝色区域。

3、将蓝色区域作为ROI，再在蓝色区域中找出所有信标，记录坐标，通过==*串口*==送至主机。

- 控制策略

控制周期：4ms

1.串级控制，外环角度环，内环角速度环。

2.需要编码器，根据麦克纳姆轮逆运动学分析，根据小车整体期望速度得出各个轮子的期望速度，增量式pid控制轮子转速。

- 路径规划

越远速度越快，角速度越小，越近速度越慢，角速度越大

状态机实现切换运行、避障等状态



------



## 智能车之摄像头组

- ==二值化算法==

阈值迭代法：选定一个初始阈值，找出高于和低于该阈值的平均灰度，计平均灰度的平均值，和初始阈值比较，当它小于初始阈值时选用它。

大津法：要遍历得到最大类间方差，速度过慢。

- ==寻线算法==

赛道的像素点是连续的，先从图像下方10行寻找连续几行的跳变点，在根据该像素点为中心的3*3的方块中逆时针寻找下一个跳变点，存入数组。优点：可以找到拐点

- 电机控制

PID(位置式pid) KP*误差+Ki*误差累计+KD*（本次误差-上次误差）



## 毕业设计

- 文本编辑控件Qscintilla

- 仿真

1、用hex数组模拟RAM，数组的下标就是物理地址。

2、汇编指令的识别方法：第一次扫描，找出所有伪指令，并做标记。然后剔除伪指令。

第二次逐行翻译汇编代码。

3、汇编代码的实现：将操作数按寻址方式，送入函数中得到物理地址。然后对对应的RAM进行操作。









